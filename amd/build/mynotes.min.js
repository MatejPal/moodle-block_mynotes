define("block_mynotes/mynotes",["exports","block_mynotes/local/mynotes/selectors","core_form/dynamicform","block_mynotes/local/mynotes/repository"],(function(_exports,_selectors,_dynamicform,Repository){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module greetings
   *
   * @module     block_mynotes/mynotes
   * @copyright  2025 Matej Pal <matej.pal@agiledrop.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.addNote=void 0,_selectors=_interopRequireDefault(_selectors),_dynamicform=_interopRequireDefault(_dynamicform),Repository=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Repository);let currentOffset=0;_exports.init=userid=>{registerEventListeners(userid)};const registerEventListeners=userid=>{document.addEventListener("click",(e=>{e.target.closest(_selectors.default.actions.showAlertButton)&&window.alert("Hello!"),window.console.log(e.target),window.console.log(userid)}))};_exports.addNote=(selector,formClass,instanceId)=>{const instanceSelector=`${selector}[data-block-instance-id="${instanceId}"]`,formElement=document.querySelector(instanceSelector);if(!formElement)return void window.console.warn("Form element not found for instance "+instanceId);if("1"===formElement.dataset.initialized)return;formElement.dataset.initialized="1";const form=new _dynamicform.default(formElement,formClass);form.addEventListener(form.events.FORM_SUBMITTED,(e=>{e.preventDefault();const response=e.detail,submitButton=formElement.querySelector('button[type="submit"]');submitButton&&(submitButton.disabled=!0),window.console.log("Form submitted: "+JSON.stringify(response)),Repository.addNote(response.userid,response.note).then((function(res){window.console.log(JSON.stringify(res)),currentOffset=0,fetchAndDisplayNotes(),submitButton&&(submitButton.disabled=!1);const inputField=formElement.querySelector('textarea[name="note"]');inputField&&(inputField.value="")})).catch((error=>{window.console.error("Error saving note:",error),submitButton&&(submitButton.disabled=!1)}))})),fetchAndDisplayNotes()};const fetchAndDisplayNotes=()=>{const notesContainers=document.querySelectorAll('[data-region="notes-container"]');notesContainers.length&&Repository.getNotes(5,currentOffset).then((response=>{const notes=response.data?response.data.notes:response.notes;notesContainers.forEach((notesContainer=>{if(notesContainer.innerHTML="",notes&&0!==notes.length){notes.forEach((note=>{const noteElement=document.createElement("div");noteElement.classList.add("note-item");const contentContainer=document.createElement("div");contentContainer.classList.add("note-content"),contentContainer.textContent=note.note;const noteFooter=document.createElement("div");noteFooter.classList.add("note-footer");const dateElem=document.createElement("small");dateElem.textContent=note.timecreated;const actionsContainer=document.createElement("div");actionsContainer.classList.add("note-actions");const editLink=document.createElement("a");editLink.setAttribute("role","button"),editLink.setAttribute("href","#"),editLink.classList.add("edit-note");const editIconUrl=M.util.image_url("t/edit","core").toString(),editAltText=M.util.get_string("edit","core");editLink.innerHTML=`<img src="${editIconUrl}" alt="${editAltText}" style="width:16px; height:16px;">`,editLink.addEventListener("click",(e=>{e.preventDefault(),contentContainer.style.display="none";let editContainer=noteElement.querySelector(".edit-container");if(editContainer){editContainer.style.display="";editContainer.querySelector("textarea").value=note.note}else{editContainer=document.createElement("div"),editContainer.classList.add("edit-container");const textarea=document.createElement("textarea");textarea.classList.add("edit-textarea"),textarea.value=note.note;const saveButton=document.createElement("button");saveButton.textContent="Save",saveButton.addEventListener("click",(()=>{const newNote=textarea.value.trim();""!==newNote?Repository.editNote(note.id,newNote).then((function(res){window.console.log("Note updated:",res),fetchAndDisplayNotes()})).catch((error=>window.console.error("Error updating note:",error))):alert("Note cannot be empty.")}));const cancelButton=document.createElement("button");cancelButton.textContent="Cancel",cancelButton.addEventListener("click",(()=>{editContainer.style.display="none",contentContainer.style.display=""})),editContainer.appendChild(textarea),editContainer.appendChild(saveButton),editContainer.appendChild(cancelButton),noteElement.insertBefore(editContainer,noteFooter)}}));const deleteLink=document.createElement("a");deleteLink.setAttribute("role","button"),deleteLink.setAttribute("href","#"),deleteLink.dataset.noteId=note.id,deleteLink.classList.add("delete-note");const iconUrl=M.util.image_url("t/delete","core").toString(),altText=M.util.get_string("delete","core");deleteLink.innerHTML=`<img src="${iconUrl}" alt="${altText}" style="width:16px; height:16px;">`,deleteLink.addEventListener("click",(e=>{e.preventDefault(),confirm("Are you sure you want to delete this note?")&&Repository.deleteNote(note.id).then((function(res){window.console.log("Note deleted:",res),fetchAndDisplayNotes()})).catch((error=>window.console.error("Error deleting note:",error)))})),actionsContainer.appendChild(editLink),actionsContainer.appendChild(deleteLink),noteFooter.appendChild(dateElem),noteFooter.appendChild(actionsContainer),noteElement.appendChild(contentContainer),noteElement.appendChild(noteFooter),notesContainer.appendChild(noteElement)}));const paginationContainer=document.createElement("div");paginationContainer.classList.add("pagination-controls");const prevButton=document.createElement("button");prevButton.textContent="Previous",prevButton.disabled=0===currentOffset,prevButton.addEventListener("click",(()=>{currentOffset>=5&&(currentOffset-=5,fetchAndDisplayNotes())}));const nextButton=document.createElement("button");nextButton.textContent="Next",nextButton.disabled=notes.length<5,nextButton.addEventListener("click",(()=>{currentOffset+=5,fetchAndDisplayNotes()})),paginationContainer.appendChild(prevButton),paginationContainer.appendChild(nextButton),notesContainer.appendChild(paginationContainer)}else notesContainer.innerHTML="<p>No notes yet.</p>"}))})).catch((error=>window.console.error("Error fetching notes:",error)))}}));

//# sourceMappingURL=mynotes.min.js.map